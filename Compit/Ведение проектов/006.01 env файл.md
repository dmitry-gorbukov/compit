
https://chat.deepseek.com/share/3oghkimmschc2s89br


Нужно создать файл `.env` для переменных окружения. Вот как правильно настроить:

## 1. Создаем файл `.env` с переменными

```bash
cd /opt/docker-services/joplin

cat > .env << 'EOF'
# PostgreSQL настройки
POSTGRES_PASSWORD=joplin123456
POSTGRES_USER=joplin
POSTGRES_DATABASE=joplin
POSTGRES_PORT=5432

# Joplin Server настройки
APP_BASE_URL=http://localhost:22300

# Дополнительные настройки (опционально)
ALLOW_SIGNUPS=true
TRANSCRIBE_ENABLED=false

# Transcribe настройки (если не используем - можно отключить)
QUEUE_DATABASE_PORT=5433
QUEUE_DATABASE_PASSWORD=transcribe123
QUEUE_DATABASE_USER=transcribe
QUEUE_DATABASE_NAME=transcribe
TRANSCRIBE_API_KEY=disabled
HTR_CLI_IMAGES_FOLDER=/tmp/transcribe-images
EOF
```

## 2. Упрощаем `compose.yml` для нашего использования

```bash
cat > compose.yml << 'EOF'
version: '3.8'

services:
    db:
        image: postgres:16
        volumes:
            - postgres-data:/var/lib/postgresql/data
        networks:
            - app-network
        restart: unless-stopped
        environment:
            - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
            - POSTGRES_USER=${POSTGRES_USER}
            - POSTGRES_DB=${POSTGRES_DATABASE}

    app:
        image: joplin/server:latest
        depends_on:
            - db
        ports:
            - "22300:22300"
        networks:
            - app-network
        restart: unless-stopped
        environment:
            - APP_PORT=22300
            - APP_BASE_URL=${APP_BASE_URL}
            - DB_CLIENT=pg
            - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
            - POSTGRES_DATABASE=${POSTGRES_DATABASE}
            - POSTGRES_USER=${POSTGRES_USER}
            - POSTGRES_PORT=5432
            - POSTGRES_HOST=db
            - ALLOW_SIGNUPS=true
            - COOKIE_SECURE=false
            - APP_PROXY=true

networks:
    app-network:

volumes:
    postgres-data:
EOF
```

## 3. Запускаем

```bash
# Останавливаем старые контейнеры
docker-compose down 2>/dev/null || true

# Запускаем
docker-compose up -d

# Ждем инициализации
echo "Ждем 3 минуты для миграций базы данных..."
sleep 180
```

## 4. Проверяем статус

```bash
# Проверим логи
docker-compose logs app | tail -20

# Проверим доступность
curl http://localhost:22300/api/ping
```

## 5. Открываем для регистрации

Теперь откройте: **http://localhost:22300/signup**

И зарегистрируйтесь с:
- **Email:** `dmitry.gorbukov@gmail.com`
- **Password:** `Re@nimaT0r4$`

## 6. Если нужен домен joplin.localhost

Обновите `.env`:

```bash
cat > .env << 'EOF'
POSTGRES_PASSWORD=joplin123456
POSTGRES_USER=joplin
POSTGRES_DATABASE=joplin
POSTGRES_PORT=5432
APP_BASE_URL=http://joplin.localhost
ALLOW_SIGNUPS=true
EOF
```

И обновите `compose.yml` для Traefik:

```yaml
# Добавьте в сервис app:
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.joplin.rule=Host(`joplin.localhost`)"
      - "traefik.http.routers.joplin.entrypoints=web"
      - "traefik.http.services.joplin.loadbalancer.server.port=22300"
    networks:
      - app-network
      - web  # Добавьте эту сеть

# И в networks добавьте:
networks:
    app-network:
    web:
        external: true
```

## 7. Перезапустите

```bash
docker-compose down
docker-compose up -d
```

Теперь будет доступно по: **http://joplin.localhost**

**Выполните шаги 1-3 сначала** чтобы настроить базовую конфигурацию с PostgreSQL. Это самый надежный способ.
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTEwNzAyMjM0MjVdfQ==
-->