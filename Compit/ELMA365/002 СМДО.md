
как подключить додкументооборот в  elma365 к СМДО в Беларусь. Инструкция и последовательность действий?

------------------------------

Отличный вопрос. Интеграция ELMA365 с Системой межведомственного электронного документооборота (СМДО) Беларуси — это комплексная задача, так как СМДО имеет строгие стандарты и требования.

ELMA365 не имеет встроенного "магического" коннектора для СМДО "из коробки". Интеграция требует настройки и, скорее всего, разработки или использования промежуточного ПО.

Вот пошаговая инструкция и последовательность действий для решения этой задачи.

### Общая схема интеграции

1.  **ELMA365** -> (REST API / Webhook) -> **Шлюз/Адаптер** -> (SOAP API СМДО) -> **СМДО**.
2.  **СМДО** -> (Уведомление через SOAP API) -> **Шлюз/Адаптер** -> (REST API ELMA365) -> **ELMA365**.

**Шлюз/Адаптер** — это ключевой компонент. Это может быть:
*   Написанное на заказ приложение (на C#, Java, Python и т.д.).
*   Настроенный инструмент iPaaS (например, Zapier, Make.com, но для СМДО маловероятно из-за специфики).
*   Использование встроенных в ELMA365 инструментов (HTTP-коннекторы, скрипты на C#), если требования СМДО не слишком сложны.

---

### Последовательность действий (Пошаговая инструкция)

#### Шаг 1: Подготовка и изучение требований СМДО

Это самый важный этап. Без него все дальнейшие действия бессмысленны.

1.  **Получите доступ к тестовой среде СМДО.** Обратитесь в оператора СМДО или уполномоченную организацию (например, "Главный информационно-аналитический центр" - ГИАЦ). Вам предоставят:
    *   Доступ к тестовому порталу.
    *   Техническую документацию на API (WSDL-схемы, описание методов).
    *   Учетные данные (логин, пароль) и данные для подписи (сертификат ЭЦП).
    *   Требования к форматам документов (например, EDM-формат).

2.  **Изучите документацию СМДО.** Обратите внимание на:
    *   **Протокол:** СМДО использует SOAP (в то время как ELMA365 в основном работает с REST). Это главная техническая сложность.
    *   **Методы API:** Какие методы используются для отправки документа (`sendDocument`), получения статуса (`getStatus`), получения входящих документов (`getIncomingDocuments`).
    *   **Электронная подпись (ЭЦП):** Все сообщения должны быть подписаны квалифицированной электронной подписью, выданной удостоверяющим центром Республики Беларусь. Нужно понять, как интегрировать механизм подписи в ваш шлюз.
    *   **Формат документов:** Часто требуется конвертация документов из внутренних форматов ELMA (PDF, DOCX) в стандартизированный для СМДО формат (например, с определенной XML-разметкой).

#### Шаг 2: Проектирование архитектуры интеграции в ELMA365

Решите, как будет выглядеть процесс в ELMA.

1.  **Создайте или модифицируйте бизнес-процесс в ELMA365.**
    *   **Для исходящих документов:** В процессе, например, после согласования документа, добавьте элемент "Сценарий" или "HTTP-запрос", который будет инициировать отправку данных во внешний шлюз.
    *   **Для входящих документов:** Создайте отдельный процесс, который будет запускаться по расписанию (через "Таймер") и проверять входящие документы через шлюз. Или настройте в шлюзе механизм уведомлений (webhook), который будет запускать процесс в ELMA365 при поступлении нового документа.

2.  **Определите структуры данных.**
    *   Создайте в ELMA типы сущностей для хранения метаданных документов СМДО: `Исходящий документ СМДО`, `Входящий документ СМДО`.
    *   В этих сущностях пропишите поля: `ID документа в СМДО`, `Статус`, `Дата отправки`, `Получатель`, `Отправитель` и т.д.

#### Шаг 3: Разработка и настройка Шлюза/Адаптера

Это ядро интеграции.

1.  **Выберите технологию.** Например, создайте приложение на C# (ASP.NET Core), которое будет выступать мостом.
2.  **Реализуйте логику для исходящих документов:**
    *   Создайте REST API endpoint (например, `POST /api/smdosend`), который будет принимать данные от ELMA365 (ID документа, метаданные, файл).
    *   Ваше приложение должно:
        *   При необходимости сконвертировать документ в требуемый СМДО формат.
        *   Подписать документ и запрос ЭЦП с использованием сертификата.
        *   Сформировать SOAP-запрос к API СМДО (метод `sendDocument`).
        *   Отправить запрос в СМДО и получить ответ.
        *   Передать статус отправки обратно в ELMA365 (через обратный вызов или обновление сущности).
3.  **Реализуйте логику для входящих документов:**
    *   Настройте в приложении периодический опрос (polling) метода СМДО `getIncomingDocuments` (или настройте подписку на уведомления, если СМДО это поддерживает).
    *   При получении нового документа:
        *   Проверить ЭЦП.
        *   Извлечь документ и метаданные.
        *   Отправить данные в ELMA365 через его REST API, чтобы создать карточку "Входящий документ СМДО" и запустить соответствующий бизнес-процесс.

#### Шаг 4: Настройка взаимодействия между ELMA365 и Шлюзом

1.  **В бизнес-процессе ELMA365 для исходящего документа:**
    *   Используйте элемент **"HTTP-запрос"** для вызова REST API вашего шлюза (`POST /api/smdosend`).
    *   В теле запроса передайте все необходимые данные в JSON-формате: `{ "documentId": "123", "recipient": "УП 'Пример'", "fileBase64": "..." }`.
2.  **Для входящих документов:**
    *   **Вариант А (Polling):** Создайте процесс с **"Таймером"**, который раз в N минут вызывает метод вашего шлюза (например, `GET /api/smdocheck`), который, в свою очередь, опрашивает СМДО.
    *   **Вариант Б (Webhook):** Настройте в вашем шлюзе вызов **Webhook URL ELMA365** при поступлении нового документа. В ELMA нужно создать endpoint для приема таких уведомлений.

#### Шаг 5: Тестирование

1.  **Протестируйте в тестовой среде СМДО.**
    *   Отправьте тестовый документ из ELMA365.
    *   Проверьте, что он успешно проходит все этапы и появляется в тестовой среде СМДО.
    *   Проверьте получение тестового документа из СМДО в ELMA365.
    *   Тщательно проверьте работу ЭЦП.

#### Шаг 6: Ввод в эксплуатацию

1.  **Получите доступ к промышленной среде СМДО.** Вам выдадут новые учетные данные и сертификаты.
2.  **Перенесите настроенную интеграцию из тестовой среды в продуктивную.** Обновите в настройках шлюза адреса API и учетные данные.
3.  **Проведите финальное тестирование** с отправкой 1-2 реальных документов.

---

### Краткий пример настройки в ELMA365 (для исходящего документа)

1.  **Процесс:** "Согласование и отправка документа в СМДО".
2.  **В конце процесса** добавляем элемент **"HTTP-запрос"**.
3.  **Настраиваем запрос:**
    *   **URL:** `https://ваш-шлюз.ru/api/smdosend`
    *   **Метод:** POST
    *   **Заголовки:** `Content-Type: application/json`
    *   **Тело запроса (в формате JSON):**
        ```json
        {
          "processId": "{{ID}}",
          "documentTitle": "{{НазваниеДокумента}}",
          "recipientCode": "{{КодПолучателя}}",
          "fileContent": "{{ФайлДокумента.Base64}}"
        }
        ```
        *(здесь используются переменные контекста процесса ELMA)*
4.  **Обработка ответа:** В элементе "HTTP-запрос" можно настроить ветвление по коду ответа от шлюза (200 OK -> "Отправлено", 500 -> "Ошибка").

### Важные замечания

*   **Сертификаты ЭЦП:** Это критически важный момент. Сертификат должен храниться безопасно, а логика подписи должна быть надежной. Часто для этого используют аппаратные токены (Рутокен, eToken) или средства криптопровайдера.
*   **Юридическая значимость:** Процесс интеграции должен быть согласован с юристами вашей организации, чтобы гарантировать, что электронный документ, отправленный через эту цепочку, будет иметь юридическую силу.
*   **Сложность:** Данная задача требует привлечения квалифицированных разработчиков, знакомых с SOAP, ЭЦП и API ELMA365.
*   **Альтернатива:** Рассмотрите возможность использования готовых коммерческих решений-коннекторов для СМДО от партнеров ELMA или других вендоров, которые, возможно, уже решили эту задачу.

Начните с **Шага 1** — получения и изучения документации от оператора СМДО. Это даст вам полное понимание объема работ.
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTIwMTk1NjQwMjZdfQ==
-->