
Расскажи как интегрировать elma365.ru с AD от Microsoft. Как настроить авторизацию и аутентификацию (определение прав для пользователей elma) ?

-----------------------


Отличный вопрос! Интеграция ELMA365 с Active Directory (AD) — это стандартная и хорошо отработанная процедура, которая позволяет централизованно управлять пользователями и их правами.

Вот пошаговая инструкция, разделенная на два больших блока: **Настройка интеграции** и **Настройка прав доступа**.

---

### Блок 1: Настройка интеграции с Active Directory

Эта настройка выполняется на стороне ELMA365 администратором платформы.

#### Шаг 1: Подготовка учётной записи в AD

В вашем домене Active Directory необходимо создать специальную учётную запись, от имени которой ELMA365 будет подключаться к AD и читать информацию о пользователях.

*   **Создайте пользователя:** Например, `svc_elma365`.
*   **Настройте права:** Этому пользователю должны быть выданы права **на чтение** данных в тех подразделениях (OU), откуда вы планируете импортировать пользователей. Минимальные права — это возможность читать атрибуты пользователей (например, `memberOf`, `sAMAccountName`, `mail` и т.д.).
*   **Рекомендация:** Поместите эту учётную запись в защищённое место (например, отдельное OU) и установите для неё "пароль, не имеющий срока действия".

#### Шаг 2: Настройка подключения в ELMA365

1.  Войдите в ELMA365 под учётной записью администратора.
2.  Перейдите в раздел **Администрирование** -> **Настройки системы** -> **Синхронизация с Active Directory**.
3.  Создайте новое подключение и заполните параметры:

    *   **Доменное имя или IP-адрес контроллера домена:** Укажите имя вашего домена (например, `company.local`) или IP-адрес конкретного контроллера домена (DC).
    *   **Порт:** Обычно используется стандартный порт LDAP — `389`. Для безопасного подключения (LDAPS) — `636`.
    *   **DN пользователя для подключения к AD:** Это Distinguished Name учётной записи, созданной на шаге 1. Выглядит примерно так: `CN=svc_elma365,OU=Service Accounts,DC=company,DC=local`.
    *   **Пароль:** Пароль для этой учётной записи.
    *   **DN контейнера для поиска пользователей:** Укажите корневой контейнер, с которого нужно начать поиск пользователей. Например: `OU=Company Users,DC=company,DC=local`. ELMA будет рекурсивно искать пользователей во всех вложенных подразделениях.
    *   **Фильтр пользователей:** Можно оставить по умолчанию `(&(objectCategory=person)(objectClass=user)(!(userAccountControl:1.2.840.113556.1.4.803:=2)))`, который отфильтровывает отключённые учётные записи. При необходимости его можно изменить.
    *   **Проверьте подключение:** Используйте кнопку "Проверить подключение", чтобы убедиться, что все параметры верны.

#### Шаг 3: Настройка сопоставления полей (Маппинг)

Здесь вы связываете атрибуты пользователя в AD с полями в ELMA365.

*   **Логин:** Сопоставляется с атрибутом `sAMAccountName` (обычно) или `userPrincipalName`.
*   **ФИО:** Сопоставляется с атрибутами `displayName`, `givenName` (имя), `sn` (фамилия).
*   **Email:** Сопоставляется с атрибутом `mail`.
*   **Телефон:** Сопоставляется с атрибутом `telephoneNumber`.
*   **Подразделение:** Можно сопоставить с атрибутом `department` или `company`.

#### Шаг 4: Настройка правил синхронизации

*   **Регламент:** Определите, как часто будет происходить синхронизация (например, каждые 15 минут).
*   **Действия:**
    *   **Создавать пользователей:** При первом запуске ELMA создаст учётные записи для всех пользователей, найденных в AD по вашему фильтру.
    *   **Обновлять пользователей:** При последующих синхронизациях данные пользователей (ФИО, email и т.д.) будут обновляться в соответствии с AD.
    *   **Блокировать/Удалять пользователей:** Вы можете настроить, что произойдёт с учётной записью в ELMA, если пользователь отключён или удалён в AD. Обычно её блокируют (лишают возможности входа).

После сохранения настроек запустите синхронизацию вручную для первоначального импорта пользователей.

---

### Блок 2: Настройка авторизации и определения прав (на основе AD)

После того как пользователи импортированы, нужно настроить их права внутри ELMA365. Самый эффективный способ — использовать группы безопасности AD.

#### Принцип: Группы AD -> Роли ELMA -> Права доступа

Идея в том, чтобы сопоставить группы безопасности из Active Directory с ролями внутри ELMA365.

#### Шаг 1: Подготовка в Active Directory

1.  Создайте в AD группы безопасности, которые логически соответствуют ролям в ELMA.
    *   Пример: `ELMA_Accountants`, `ELMA_HR_Managers`, `ELMA_Sales_Department`.
2.  Добавьте нужных пользователей в эти группы.

#### Шаг 2: Настройка синхронизации групп AD с ELMA

Вернитесь в настройки синхронизации с AD в ELMA.

1.  **Включите синхронизацию групп:** В настройках подключения к AD найдите опцию для синхронизации групп (членства в группах).
2.  **Укажите фильтр групп:** Аналогично пользователям, укажите, какие группы синхронизировать (например, по префиксу `ELMA_*`).
3.  **Настройте маппинг для групп:** Сопоставьте атрибуты группы AD (например, `sAMAccountName` или `CN`) с названием роли/группы в ELMA.

#### Шаг 3: Создание и настройка Ролей в ELMA365

1.  В ELMA365 перейдите в **Администрирование** -> **Пользователи и права доступа** -> **Роли**.
2.  Создайте роли с именами, которые будут совпадать с именами синхронизируемых групп AD (или на которые они маппятся).
    *   Пример: создайте роли "Бухгалтеры", "Менеджеры по персоналу".
3.  **Ключевой момент:** В настройках синхронизации с AD вы свяжете группу `ELMA_Accountants` с ролью "Бухгалтеры". При синхронизации все пользователи из этой группы AD автоматически получат соответствующую роль в ELMA.

#### Шаг 4: Назначение прав на основе ролей

Теперь вы можете назначать права доступа в ELMA не конкретным пользователям, а **ролям**.

*   **Права на бизнес-процессы:** Какие процессы могут запускать представители роли.
*   **Права на приложения и объекты:** Какие CRM-карточки, документы, проекты они могут просматривать, создавать, редактировать.
*   **Права на порталы и разделы:** Доступ к определённым разделам корпоративного портала.

Например, вы можете настроить, что роль "Бухгалтеры" имеет право:
*   Запускать процесс "Согласование авансового отчёта".
*   Просматривать все объекты в приложении "Финансы".
*   Видеть раздел портала "Внутренние регламенты".

Когда новый бухгалтер приходит в компанию, ему в AD добавляют учётную запись и включают в группу `ELMA_Accountants`. При следующей синхронизации он автоматически появится в ELMA и получит ВСЕ необходимые для работы права. Когда он увольняется, его достаточно отключить в AD — и он потеряет доступ к ELMA.

### Резюме и лучшие практики:

1.  **Используйте сервисную учётную запись** с минимально необходимыми правами (только на чтение).
2.  **Синхронизируйте не всех пользователей AD,** а только тех, кому нужен доступ к ELMA. Используйте правильные OU и фильтры.
3.  **Управление правами через группы AD — это золотой стандарт.** Это делает систему безопасной, прозрачной и легко управляемой для IT-администраторов.
4.  **Проверяйте логи синхронизации** после настройки, чтобы убедиться, что пользователи и группы импортируются корректно.
5.  **Не назначайте права напрямую пользователям** в ELMA, всегда используйте роли, привязанные к группам AD.

Эта схема обеспечивает надежную, централизованную и легко сопровождаемую систему аутентификации и авторизации между ELMA365 и Active Directory.
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTE0ODIwODA5NjZdfQ==
-->